# Руководство администратора SP-Агент

## Вход в систему

### Учетные данные администратора:
- **Логин:** `admin`
- **Пароль:** `Chelsea1905`

### Как войти:
1. Откройте главную страницу приложения
2. Нажмите кнопку "Админ-панель" в правом верхнем углу
3. Введите логин и пароль
4. Нажмите "Войти"

## Панель администратора

После входа вы попадете в панель управления документами.

### Основные возможности:

#### 1. Загрузка документов СП

**Требования к файлам:**
- Формат: `.txt` (текстовый файл)
- Минимальный размер: 100 символов
- Кодировка: UTF-8 (рекомендуется)

**Процесс загрузки:**

1. В разделе "Загрузка нового документа СП":
   - Введите название документа (например: "СП 60.13330.2020")
   - Выберите файл .txt с вашего компьютера
   - Название автоматически заполнится из имени файла
   - Нажмите "Загрузить документ"

2. Подождите завершения индексации:
   - Процесс может занять несколько минут
   - Документ будет разбит на фрагменты
   - Для каждого фрагмента создастся векторное представление
   - После завершения появится уведомление с количеством обработанных фрагментов

#### 2. Просмотр загруженных документов

В разделе "Загруженные документы" отображается:
- Список всех документов в системе
- Количество фрагментов для каждого документа
- Дата последнего обновления
- Статус индексации (зеленая галочка)

#### 3. Удаление документов

Для удаления документа:
1. Найдите нужный документ в списке
2. Нажмите кнопку "Удалить"
3. Подтвердите удаление в диалоговом окне

⚠️ **Внимание:** Удаление необратимо! Все фрагменты будут удалены из базы данных.

#### 4. Переиндексация документов

Если нужно обновить содержимое документа:
1. Удалите старую версию документа
2. Загрузите новую версию с тем же или другим названием

## Подготовка файлов .txt

### Способы конвертации PDF в TXT:

#### Вариант 1: Онлайн-конвертеры (самый простой)
- https://pdf2txt.de/
- https://www.online-convert.com/
- https://cloudconvert.com/pdf-to-txt

**Инструкция:**
1. Откройте любой из сервисов
2. Загрузите PDF файл
3. Конвертируйте в TXT
4. Скачайте результат
5. Используйте в админ-панели

#### Вариант 2: Adobe Acrobat
1. Откройте PDF в Adobe Acrobat
2. Файл → Сохранить как → Текст (TXT)
3. Сохраните файл

#### Вариант 3: Командная строка (Linux/Mac)
```bash
pdftotext документ.pdf документ.txt
```

### Рекомендации по качеству:

✅ **Хорошо:**
- Текст PDF был создан из электронного документа
- Текст можно выделять и копировать
- Структура документа сохранена

❌ **Плохо:**
- PDF получен сканированием (нужен OCR)
- Текст с большим количеством ошибок
- Нечитаемые символы

## Как работает система

### Процесс индексации:

1. **Загрузка файла** → Текст считывается из .txt файла
2. **Chunking** → Текст разбивается на фрагменты ~1000 символов
3. **Embeddings** → Для каждого фрагмента создается векторное представление (OpenAI API)
4. **Сохранение** → Фрагменты с векторами сохраняются в PostgreSQL с pgvector
5. **Индексация** → Создается векторный индекс для быстрого поиска

### Процесс поиска:

1. Пользователь задает вопрос
2. Вопрос преобразуется в вектор
3. Ищутся 5 наиболее похожих фрагментов из ВСЕХ документов
4. Фрагменты передаются DeepSeek как контекст
5. DeepSeek генерирует ответ на основе найденных фрагментов
6. В ответе указывается, из какого документа взята информация

## Пользовательский опыт

После загрузки документов:

- На главной странице отображается количество загруженных документов
- В приветственном сообщении показан список всех СП
- Пользователи могут задавать вопросы по любому загруженному документу
- DeepSeek автоматически указывает источник информации

**Пример работы:**

```
Пользователь: "Какая температура должна быть в жилых помещениях?"

SP-Агент: "Согласно СП 60.13330.2020, температура в жилых 
помещениях должна составлять..."
```

## Лучшие практики

### Именование документов:
- Используйте официальные названия: "СП 60.13330.2020"
- Можно добавлять краткое описание: "СП 60.13330.2020 - ОВиК"
- Избегайте дублирования названий

### Управление документами:
- Регулярно проверяйте актуальность документов
- Удаляйте устаревшие версии
- Обновляйте документы при выходе новых редакций

### Качество файлов:
- Проверяйте текст перед загрузкой
- Убедитесь, что нет критических ошибок
- Оставляйте структуру документа (заголовки, нумерация)

## Технические характеристики

### Ограничения:
- Размер файла: не ограничен, но большие файлы дольше обрабатываются
- Формат: только .txt
- Кодировка: UTF-8 (рекомендуется)

### Производительность:
- ~1000 символов = 1 фрагмент
- ~5 фрагментов обрабатывается за раз
- ~1-2 секунды на фрагмент (создание embedding)
- Документ на 100 страниц ≈ 5-10 минут обработки

### Стоимость:
- OpenAI Embeddings: ~$0.02 за 1M токенов
- Средний документ СП: ~$0.10-0.50 за индексацию
- Поиск: бесплатно (только база данных)
- DeepSeek: бесплатно (free tier)

## Устранение проблем

### Ошибка: "Файл слишком короткий"
→ Убедитесь, что файл содержит минимум 100 символов текста

### Ошибка: "Пожалуйста, выберите файл в формате .txt"
→ Конвертируйте PDF в TXT перед загрузкой

### Ошибка: "OPENAI_API_KEY is not configured"
→ Проверьте настройки Edge Functions в Supabase Dashboard

### Ошибка: "Не удалось загрузить документ"
→ Проверьте:
1. Стабильность интернет-соединения
2. Валидность OpenAI API ключа
3. Логи Edge Functions в Supabase

### Процесс застревает на середине
→ Возможные причины:
- Превышен лимит OpenAI API (проверьте квоту)
- Проблемы с сетью
- Слишком большой файл (попробуйте разбить на части)

## Безопасность

### Текущая реализация:
- Авторизация хранится в localStorage браузера
- Пароль захардкожен в коде (для демо)
- Доступ к базе данных открыт (RLS настроен на PUBLIC)

### Рекомендации для production:
1. Перенести авторизацию на Supabase Auth
2. Использовать переменные окружения для учетных данных
3. Настроить RLS для ограничения доступа
4. Добавить HTTPS
5. Включить аудит действий администратора

## Горячие клавиши

- `Ctrl + R` - Обновить список документов
- `Esc` - Закрыть диалоги

## Поддержка

При возникновении вопросов:
1. Проверьте логи в консоли браузера (F12)
2. Проверьте логи Edge Functions в Supabase Dashboard
3. См. техническую документацию в `ARCHITECTURE.md`

---

**Версия:** 2.0  
**Последнее обновление:** Октябрь 2025

